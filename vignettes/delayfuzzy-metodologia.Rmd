
---
title: "Corre√ß√£o do atraso de notifica√ß√£o por estimadores fuzzy triangulares"
author: "delayfuzzy"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Corre√ß√£o do atraso de notifica√ß√£o por estimadores fuzzy triangulares}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r config-geral, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = FALSE,
  fig.width = 7,
  fig.height = 5,
  out.width = "70%"
)
```

```{r carrega-pacotes, include=FALSE}
library(delayfuzzy)  # Agora funciona!
```

---

## 1. Introdu√ß√£o

Sistemas de vigil√¢ncia epidemiol√≥gica baseados em notifica√ß√£o compuls√≥ria est√£o sujeitos a atrasos entre a ocorr√™ncia do evento de interesse e sua consolida√ß√£o nos bancos oficiais. Esses atrasos comprometem a an√°lise em tempo oportuno, especialmente durante epidemias, quando decis√µes de sa√∫de p√∫blica dependem de estimativas atualizadas. O pacote delayfuzzy implementa um m√©todo para corre√ß√£o do atraso de notifica√ß√£o baseado em:

matrizes de atraso por semana epidemiol√≥gica;
estimadores de corre√ß√£o $F_j$;
modelagem da incerteza por n√∫meros fuzzy triangulares;
propaga√ß√£o da incerteza ao longo do tempo.
O m√©todo foi desenvolvido para dados do SIVEP-Gripe (OpenDatasus), mas pode
ser aplicado a qualquer sistema com datas de in√≠cio de sintomas e notifica√ß√£o.
---

## Defini√ß√£o do atraso de notifica√ß√£o

O pacote delayfuzzy implementa um m√©todo para corre√ß√£o do atraso de
notifica√ß√£o baseado em:

matrizes de atraso por semana epidemiol√≥gica;
estimadores de corre√ß√£o $F_j$;
modelagem da incerteza por n√∫meros fuzzy triangulares;
propaga√ß√£o da incerteza ao longo do tempo.

O m√©todo foi desenvolvido para dados do SIVEP-Gripe (OpenDatasus), mas pode
ser aplicado a qualquer sistema com datas de in√≠cio de sintomas e notifica√ß√£o.

Defini√ß√£o do atraso de notifica√ß√£o

Sejam:

$D^{(s)}_i$: data de in√≠cio dos sintomas do caso $i$;

$D^{(n)}_i$: data de notifica√ß√£o do caso $i$.

Define-se o atraso de notifica√ß√£o em dias como:

```{r figura1, echo=FALSE, out.width="70%"}
knitr::include_graphics("figuras/imagem_1.png")
```
O atraso em semanas epidemiol√≥gicas √© obtido por:

```{r figura2, echo=FALSE, out.width="70%"}
knitr::include_graphics("figuras/imagem_2.png")
```

No pacote, esse c√°lculo √© realizado pela fun√ß√£o:

```{r carrega-fun√ß√£o1, include=FALSE}
calcular_atraso()
```

que adiciona a vari√°vel atrasoSemanas √† base de dados.

## Constru√ß√£o da matriz de atraso

Considere:

$i = 1, \dots, 53$: semanas epidemiol√≥gicas de notifica√ß√£o;
$j = 0, \dots, 52$: atraso em semanas.
A matriz de atraso $X$ √© definida como:

```{r figura3, echo=FALSE, out.width="70%"}
knitr::include_graphics("figuras/imagem_3.png")
```
A matriz √© constru√≠da por tabula√ß√£o cruzada entre a semana epidemiol√≥gica de
notifica√ß√£o (SEM_NOT) e o atraso em semanas.

Apenas registros v√°lidos s√£o considerados:

semanas epidemiol√≥gicas entre 1 e 53;
atrasos entre 0 e 52 semanas;
aus√™ncia de valores ausentes.

Registros fora desses crit√©rios s√£o automaticamente exclu√≠dos, e o usu√°rio √©
informado por meio de um warning.

No pacote, essa etapa √© implementada por:

```{r carrega-fun√ß√£o2, include=FALSE}
matriz_atraso()
```

## Matriz Cumulativa de atraso

A matriz cumulativa $C$ √© definida como:

```{r figura4, echo=FALSE, out.width="70%"}
knitr::include_graphics("figuras/imagem_4.png")
```
Essa matriz representa o n√∫mero acumulado de notifica√ß√µes at√© o atraso $j$,
para cada semana epidemiol√≥gica $i$.

Por constru√ß√£o, $C$ √© uma matriz triangular inferior e n√£o decrescente ao longo
de $j$.

No pacote, essa transforma√ß√£o √© realizada por:

```{r carrega-fun√ß√£o3, include=FALSE}
matriz_cumulativa()
```

## Estimador de corre√ß√£o do atraso

Para cada atraso $j$, define-se o estimador de corre√ß√£o $F_j$ como:

```{r figura5, echo=FALSE, out.width="70%"}
knitr::include_graphics("figuras/imagem_5.png")
```

onde $I$ √© o n√∫mero total de semanas consideradas.

O estimador $F_j$ representa a propor√ß√£o esperada de casos acumulados at√© o
atraso $j$, em rela√ß√£o ao atraso $j+1$.

Por defini√ß√£o, espera-se que:

```{r figura6, echo=FALSE, out.width="70%"}
knitr::include_graphics("figuras/imagem_6.png")
```
No pacote, esse estimador √© calculado pela fun√ß√£o:

```{r carrega-fun√ß√£o4, include=FALSE}
estimar_Fj()
```

O √≠ndiceùëórepresenta o atraso em semanas. Embora o banco de dados possa conter atrasos de at√© 52 semanas, valores espec√≠ficos deùëópodem ser analisados isoladamente para fins explorat√≥rios ou ilustrativos. Nos exemplos deste vignette, utilizamosùëó= 3 por corresponder a um atraso curto, t√≠pico dos fluxos operacionais de vigil√¢ncia epidmeiol√≥gica. A fun√ß√£o de alto n√≠vel do pacote estima automaticamente todos os valores deùêπùëódispon√≠veis no banco, sem necessidade de escolha manual.

## Modelagem da incerteza por n√∫meros fuzzy triangulares

Para incorporar incerteza na estimativa do atraso, cada $F_j$ √© representado
como um n√∫mero fuzzy triangular (NFT):

```{r figura7, echo=FALSE, out.width="70%"}
knitr::include_graphics("figuras/imagem_7.png")
```
onde:

$F_j$ √© o valor central;
$\ell_j$ √© a largura fuzzy, estimada a partir dos dados observados.
A largura $\ell_j$ √© definida como:

```{r figura8, echo=FALSE, out.width="70%"}
knitr::include_graphics("figuras/imagem_8.png")
```

Essa etapa √© implementada no pacote pela fun√ß√£o:

```{r carrega-fun√ß√£o5, include=FALSE}
calc_lj()
```

## Estima√ß√£o da incerteza

A previs√£o do valor acumulado na semana seguinte √© dada por:

```{r figura9, echo=FALSE, out.width="70%"}
knitr::include_graphics("figuras/imagem_9.png")
```
onde $\otimes$ representa a multiplica√ß√£o fuzzy triangular.
Sejam:

$\tilde{A} = (a, \ell_a, r_a)$
$\tilde{B} = (b, \ell_b, r_b)$

A multiplica√ß√£o fuzzy √© aproximada por:

```{r figura10, echo=FALSE, out.width="70%"}
knitr::include_graphics("figuras/imagem_10.png")
```
Essa opera√ß√£o √© implementada pela fun√ß√£o:

```{r carrega-fun√ß√£o5, include=FALSE}
mult_fuzzy()
```

Embora a corre√ß√£o do atraso seja realizada por uma fun√ß√£o de alto n√≠vel, o pacote disponibiliza essas fun√ß√µes internas que permitem explorar e compreender cada etapa do modelo. Em particular, a fun√ß√£o mult_fuzzy() permite demonstrar, em exemplos simplificados, como a incerteza associada ao fator de corre√ß√£o √© propagada ao longo do tempo.

A estima√ß√£o temporal completa da incerteza √© realizada por:

```{r carrega-fun√ß√£o6, include=FALSE}
propagar_fuzzy()
```

que retorna:

matriz central das previs√µes;
matriz das laterais esquerdas;
matriz das laterais direitas.

## Fun√ß√£o de alto n√≠vel do pacote

Para facilitar o uso por analistas e profissionais da vigil√¢ncia, o pacote
disponibiliza uma fun√ß√£o √∫nica que executa todo o pipeline metodol√≥gico:

```{r carrega-fun√ß√£o7, include=FALSE}
estimacao_delay_fuzzy()
```

Essa fun√ß√£o:

calcula o atraso de notifica√ß√£o;
constr√≥i a matriz de atraso;
gera a matriz cumulativa;
estima $F_j$ e $\ell_j$;
propaga a incerteza fuzzy.

O retorno √© uma lista contendo todas as matrizes intermedi√°rias e finais,
permitindo inspe√ß√£o completa do processo.

## Exemplo de uso

```{r carrega-fun√ß√£o8, include=FALSE}
library(delayfuzzy)

resultado <- estimacao_delay_fuzzy(
  dados = dados,
  data_notificacao = "DT_NOTIFIC",
  data_sintomas    = "DT_SIN_PRI"
)

names(resultado)
```

## Considera√ß√µes finais

O pacote delayfuzzy fornece uma implementa√ß√£o reprodut√≠vel e extens√≠vel
para corre√ß√£o do atraso de notifica√ß√£o em sistemas de vigil√¢ncia epidemiol√≥gica,
incorporando explicitamente a incerteza inerente ao processo de notifica√ß√£o.

O m√©todo √© particularmente √∫til em cen√°rios de vigil√¢ncia em tempo quase real,
onde estimativas pontuais podem ser enganosas e intervalos fuzzy oferecem uma
representa√ß√£o mais realista da incerteza

---
